{"ast":null,"code":"import _slicedToArray from \"/app/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/app/frontend/src/components/feed.component.js\";\nimport React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { Redirect, Link } from \"react-router-dom\";\nimport { variables } from \"../urls.js\";\n\nfunction useForceUpdate() {\n  let _useState = useState(true),\n      _useState2 = _slicedToArray(_useState, 2),\n      value = _useState2[0],\n      setState = _useState2[1];\n\n  return () => setState(!value);\n}\n\nlet renderedFeed = \"\";\n\nfunction Feed(props) {\n  const _useState3 = useState(null),\n        _useState4 = _slicedToArray(_useState3, 2),\n        feed = _useState4[0],\n        setFeed = _useState4[1];\n\n  const _useState5 = useState(null),\n        _useState6 = _slicedToArray(_useState5, 2),\n        tags = _useState6[0],\n        setTags = _useState6[1];\n\n  const _useState7 = useState(\"\"),\n        _useState8 = _slicedToArray(_useState7, 2),\n        tag_filter = _useState8[0],\n        setTagFilter = _useState8[1];\n\n  const forceUpdate = useForceUpdate();\n\n  const addNewComment = async (e, data) => {\n    e.preventDefault();\n    const commentContent = e.target[0].value;\n    const bookId = e.target.id;\n    const url = variables.serverUrl + variables.postCommentEndpoint;\n    const token = props.getToken();\n    const res = axios.post(url, {\n      content: commentContent,\n      book_id: bookId,\n      user_id: 1\n    }, {\n      headers: {\n        Authorization: 'Bearer ' + token.access\n      },\n      crossDomain: false\n    });\n    e.target.reset();\n    fetchFeed();\n  };\n\n  const likeBook = async () => {};\n\n  const fetchTags = async () => {\n    const url = variables.serverUrl + variables.fetchTagsEndpoint;\n    const token = props.getToken();\n    const response = await axios.get(url, {\n      headers: {\n        Authorization: 'Bearer ' + token.access\n      },\n      crossDomain: false,\n      params: {\n        user_id: '1'\n      }\n    });\n    setTags(response.data);\n  };\n\n  const fetchFeed = async () => {\n    const url = variables.serverUrl + variables.fetchFeedEndpoint;\n    const token = props.getToken();\n    const response = await axios.get(url, {\n      headers: {\n        Authorization: 'Bearer ' + token.access\n      },\n      crossDomain: false,\n      params: {\n        user_id: '1'\n      }\n    });\n    setFeed(response.data);\n  };\n\n  useEffect(() => {\n    fetchFeed();\n    fetchTags();\n  }, []);\n  useEffect(() => {\n    renderFeed();\n  }, [feed]);\n\n  function getTagCards(tags) {\n    var t = [];\n\n    for (var i in tags) {\n      t.push(React.createElement(\"div\", {\n        className: \"pill\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65\n        },\n        __self: this\n      }, tags[i].name));\n    }\n\n    return t;\n  }\n\n  function bookmatchesTag(book) {\n    console.log(book);\n    console.log(tag_filter);\n    if (tag_filter == \"\") return true;\n\n    for (var i in book.tags) {\n      if (tag_filter == book.tags[i].name) return true;\n    }\n\n    return false;\n  }\n\n  function renderFeed() {\n    if (feed) {\n      renderedFeed = [];\n\n      for (var i = 0; i < feed.length; i++) {\n        if (bookmatchesTag(feed[i])) {\n          renderedFeed.push(React.createElement(\"div\", {\n            className: \"feed-card \",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 91\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"book row\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 92\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"header\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 93\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            className: \"profile-picture\",\n            src: require('../static/pf.png'),\n            alt: \"profile picture\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 94\n            },\n            __self: this\n          }), React.createElement(\"div\", {\n            className: \"username\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 95\n            },\n            __self: this\n          }, feed[i].user.first_name), React.createElement(\"div\", {\n            className: \"timestamp\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 98\n            },\n            __self: this\n          }, feed[i].time_ago)), React.createElement(\"div\", {\n            className: \"column\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 102\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 103\n            },\n            __self: this\n          }, React.createElement(Link, {\n            className: \"title\",\n            to: \"/book/\" + feed[i].id + \"/notes\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 104\n            },\n            __self: this\n          }, React.createElement(\"h4\", {\n            id: feed[i].id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 105\n            },\n            __self: this\n          }, feed[i].title))), React.createElement(\"div\", {\n            className: \"description\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 111\n            },\n            __self: this\n          }, feed[i].description)), React.createElement(\"div\", {\n            className: \"column-right\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 116\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"feed-card-tags\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 117\n            },\n            __self: this\n          }, getTagCards(feed[i].tags)))), React.createElement(\"div\", {\n            className: \"comments\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 123\n            },\n            __self: this\n          }, feed[i].comments.map(comment => React.createElement(\"div\", {\n            className: \"comment\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 126\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"header\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 127\n            },\n            __self: this\n          }, React.createElement(\"img\", {\n            className: \"profile-picture\",\n            src: require('../static/pf.png'),\n            alt: \"profile picture\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 128\n            },\n            __self: this\n          }), React.createElement(\"div\", {\n            className: \"username\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 129\n            },\n            __self: this\n          }, comment.user.first_name), React.createElement(\"div\", {\n            className: \"timestamp\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 130\n            },\n            __self: this\n          }, comment.time_ago)), React.createElement(\"div\", {\n            className: \"\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 132\n            },\n            __self: this\n          }, comment.content)))), React.createElement(\"div\", {\n            className: \"container\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 137\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"row\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 138\n            },\n            __self: this\n          }, React.createElement(\"div\", {\n            className: \"column-sm new-comment\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 139\n            },\n            __self: this\n          }, React.createElement(\"form\", {\n            onSubmit: addNewComment,\n            id: feed[i].id,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 140\n            },\n            __self: this\n          }, React.createElement(\"input\", {\n            placeholder: \"Add new comment\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 141\n            },\n            __self: this\n          })))))));\n        }\n      }\n\n      forceUpdate();\n    } else {\n      renderedFeed = \"\";\n    }\n  }\n\n  const sortByTag = e => {\n    const tag = e.target[1].value;\n\n    if (tag == \"Sort by tag\") {\n      setTagFilter(\"\");\n    } else {\n      setTagFilter(tag);\n    }\n\n    renderedFeed();\n  };\n\n  function getTags() {\n    var tagnames = [];\n\n    for (var i in tags) {\n      tagnames.push(React.createElement(\"option\", {\n        value: \"\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 174\n        },\n        __self: this\n      }, tags[i].name));\n    }\n\n    return tagnames;\n  }\n\n  return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n    className: \"feed\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 183\n    },\n    __self: this\n  }, React.createElement(\"select\", {\n    onChange: sortByTag,\n    name: \"pets\",\n    id: \"pet-select\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184\n    },\n    __self: this\n  }, React.createElement(\"option\", {\n    value: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185\n    },\n    __self: this\n  }, \"Sort by tag\"), getTags()), renderedFeed));\n}\n\nexport default Feed;","map":{"version":3,"sources":["/app/frontend/src/components/feed.component.js"],"names":["React","useState","useEffect","axios","Redirect","Link","variables","useForceUpdate","value","setState","renderedFeed","Feed","props","feed","setFeed","tags","setTags","tag_filter","setTagFilter","forceUpdate","addNewComment","e","data","preventDefault","commentContent","target","bookId","id","url","serverUrl","postCommentEndpoint","token","getToken","res","post","content","book_id","user_id","headers","Authorization","access","crossDomain","reset","fetchFeed","likeBook","fetchTags","fetchTagsEndpoint","response","get","params","fetchFeedEndpoint","renderFeed","getTagCards","t","i","push","name","bookmatchesTag","book","console","log","length","require","user","first_name","time_ago","title","description","comments","map","comment","sortByTag","tag","getTags","tagnames"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\nimport { Redirect, Link} from \"react-router-dom\";\nimport {variables} from \"../urls.js\";\n\nfunction useForceUpdate(){\n  let [value, setState] = useState(true);\n  return () => setState(!value);\n}\n\nlet renderedFeed = \"\";\n\nfunction Feed(props) {\n  const [feed, setFeed] = useState(null);\n  const [tags, setTags] = useState(null);\n  const [tag_filter, setTagFilter] = useState(\"\");\n  const forceUpdate = useForceUpdate();\n\n  const addNewComment = async (e, data) => {\n    e.preventDefault();\n    const commentContent = e.target[0].value;\n    const bookId = e.target.id\n\n    const url = variables.serverUrl + variables.postCommentEndpoint;\n    const token = props.getToken();\n    const res = axios.post(url, {\n        content: commentContent,\n        book_id: bookId,\n        user_id: 1,\n    }, { headers: { Authorization: 'Bearer ' + token.access }, crossDomain: false });\n\n    e.target.reset();\n    fetchFeed();\n  }\n\n  const likeBook = async () => {\n  }\n  const fetchTags = async () => {\n    const url = variables.serverUrl + variables.fetchTagsEndpoint;\n    const token = props.getToken();\n    const response = await axios.get(url, { headers: { Authorization: 'Bearer ' + token.access }, crossDomain: false, params: {user_id: '1'}});\n    setTags(response.data);\n  }\n  const fetchFeed = async () => {\n    const url = variables.serverUrl + variables.fetchFeedEndpoint;\n    const token = props.getToken();\n    const response = await axios.get(url, { headers: { Authorization: 'Bearer ' + token.access }, crossDomain: false, params: {user_id: '1'}});\n    setFeed(response.data);\n  }\n\n\n  useEffect(() => {\n    fetchFeed();\n    fetchTags();\n\t}, []);\n\n  useEffect(() => {\n    renderFeed();\n\t}, [feed]);\n\n  function getTagCards(tags) {\n    var t = [];\n    for (var i in tags) {\n      t.push(\n        <div className=\"pill\">\n          {tags[i].name}\n        </div>\n      );\n    }\n    return t;\n  }\n\n  function bookmatchesTag(book) {\n    console.log(book);\n    console.log(tag_filter);\n    if (tag_filter == \"\")\n      return true;\n    for(var i in book.tags)\n    {\n      if (tag_filter == book.tags[i].name)\n        return true;\n    }\n    return false;\n  }\n  function renderFeed() {\n    if (feed) {\n      renderedFeed = [];\n      for(var i = 0; i < feed.length; i++) {\n        if (bookmatchesTag(feed[i])) {\n        renderedFeed.push(\n          <div className=\"feed-card \">\n          <div className=\"book row\">\n            <div className=\"header\">\n             <img className=\"profile-picture\" src={require('../static/pf.png')} alt=\"profile picture\"/> \n              <div className=\"username\">\n                {feed[i].user.first_name}\n              </div>\n              <div className=\"timestamp\">\n                {feed[i].time_ago}\n              </div>\n            </div>\n            <div className=\"column\">\n                <div>\n                    <Link className=\"title\" to={\"/book/\" + feed[i].id + \"/notes\"} >\n                      <h4 id={feed[i].id}>\n                          {feed[i].title}\n                  \n                      </h4>\n                    </Link> \n                </div>\n                <div className=\"description\">\n                  {feed[i].description}\n                </div>\n              \n            </div>\n            <div className=\"column-right\">\n              <div className=\"feed-card-tags\">\n                  {getTagCards(feed[i].tags)}\n              </div>\n            </div>\n          \n          </div>\n        <div className=\"comments\">\n                {feed[i].comments.map( \n                  comment => (\n                    <div className=\"comment\">\n                    <div className=\"header\">\n                         <img className=\"profile-picture\" src={require('../static/pf.png')} alt=\"profile picture\"/> \n                        <div className=\"username\">{comment.user.first_name}</div>\n                        <div className=\"timestamp\">{comment.time_ago}</div>\n                    </div>\n                      <div className=\"\">{comment.content}</div>\n                    </div>\n                  )\n                )}\n          </div>\n          <div className=\"container\">\n          <div className=\"row\">\n              <div className=\"column-sm new-comment\">\n                <form onSubmit={addNewComment} id={feed[i].id}>\n                  <input placeholder=\"Add new comment\" />\n                </form>\n              </div>\n          \n          </div>\n          \n          </div>\n          </div>\n        );\n        }\n      }\n      forceUpdate();\n    }\n    else {\n      renderedFeed = \"\";\n    }\n\n  }\n  const sortByTag = (e) => {\n    const tag = e.target[1].value;\n    if (tag == \"Sort by tag\"){\n      setTagFilter(\"\");\n    }\n    else {\n      setTagFilter(tag);\n    }\n    renderedFeed();\n\n  }\n  function getTags() {\n    var tagnames = []\n    for (var i in tags) {\n      tagnames.push(\n        <option value=\"\">\n        {tags[i].name}\n        </option>\n      );\n    }\n    return tagnames\n  }\n  return (\n    <>\n          <div className=\"feed\">\n      <select onChange={sortByTag} name=\"pets\" id=\"pet-select\">\n        <option value=\"\">Sort by tag</option>\n    {getTags()}\n</select>\n\n            {renderedFeed}\n          </div>\n    </>\n\n  )\n\n}\n\nexport default Feed;\n"]},"metadata":{},"sourceType":"module"}